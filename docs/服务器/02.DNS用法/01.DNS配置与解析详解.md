---
title: DNS 配置与解析详解
date: 2026-02-04 14:15:00
permalink: /pages/dns-config-guide/
categories:
  - 服务器
  - DNS
tags:
  - DNS
  - 域名解析
  - 运维
author:
  name: guqzhou
  link: https://github.com/guqzhou
---

# DNS 配置与解析详解

域名系统（DNS）是互联网的电话簿，将人类可读的域名（如 `example.com`）转换为机器可读的 IP 地址（如 `192.0.2.1`）。本文档详细总结了常见的 DNS 记录类型及其应用场景。

## 1. 核心记录类型 (A, CNAME, AAAA)

这些是搭建网站最常用的记录类型。

### A 记录 (Address Record)

- **作用**：将域名指向一个 **IPv4 地址**。
- **场景**：
  - 网站部署在拥有固定 IP 的云服务器（如阿里云 ECS、腾讯云 CVM）上。
  - 绑定根域名（`example.com`）到 GitHub Pages（虽然 GitHub 推荐 CNAME，但根域名必须用 A 记录或 Alias）。
- **示例**：
  | 主机记录 | 记录类型 | 记录值 | TTL |
  | :--- | :--- | :--- | :--- |
  | @ | A | 185.199.108.153 | 600 |

### CNAME 记录 (Canonical Name Record)

- **作用**：将域名指向 **另一个域名**（别名）。
- **场景**：
  - **CDN 加速**：将 `img.example.com` 指向 CDN 提供的 `img.example.com.w.kunlungr.com`。
  - **GitHub Pages / Vercel**：将 `www.example.com` 指向 `username.github.io`。服务商更换 IP 时，无需更改配置。
  - **企业邮箱 Web 端**：将 `mail.example.com` 指向 `mail.mxhichina.com`。
- **注意**：
  - **根域名冲突**：标准规定根域名（`@`）不能配置 CNAME 记录（会与 MX 记录冲突）。这就是为什么根域名通常用 A 记录，或者部分 DNS 服务商提供的 CNAME 加速（Alias/CNAME Flattening）。
- **示例**：
  | 主机记录 | 记录类型 | 记录值 | TTL |
  | :--- | :--- | :--- | :--- |
  | www | CNAME | guqzhou.github.io | 600 |

### AAAA 记录

- **作用**：将域名指向一个 **IPv6 地址**。
- **场景**：网站支持 IPv6 访问。随着 IPv6 普及，建议同时配置 A 和 AAAA 记录。
- **示例**：
  | 主机记录 | 记录类型 | 记录值 |
  | :--- | :--- | :--- |
  | @ | AAAA | 2606:50c0:8000::153 |

---

## 2. 功能性记录类型 (MX, TXT, NS)

### MX 记录 (Mail Exchange)

- **作用**：指定用于接收发送到该域名的邮件的邮件服务器。
- **场景**：使用企业邮箱（如 `admin@example.com`）。
- **优先级**：数字越小优先级越高。
- **示例**：
  | 主机记录 | 记录类型 | 记录值 | 优先级 |
  | :--- | :--- | :--- | :--- |
  | @ | MX | mxbiz1.qq.com | 5 |
  | @ | MX | mxbiz2.qq.com | 10 |

### TXT 记录 (Text)

- **作用**：存储文本信息，对用户访问无影响，主要用于**验证**。
- **场景**：
  1.  **域名所有权验证**：申请 SSL 证书、绑定 Google Search Console/百度资源平台。
  2.  **SPF 记录 (反垃圾邮件)**：声明哪些 IP 允许代表该域名发邮件。例如：`v=spf1 include:spf.mail.qq.com ~all`。
- **示例**：
  | 主机记录 | 记录类型 | 记录值 |
  | :--- | :--- | :--- |
  | @ | TXT | google-site-verification=... |

### NS 记录 (Name Server)

- **作用**：指定该域名由哪个 **DNS 服务器** 进行解析。
- **场景**：
  - **子域名授权**：将 `sub.example.com` 的解析权交给另一个 DNS 服务商。
  - **更换 DNS 服务商**：比如在阿里云注册的域名，修改 NS 记录指向 Cloudflare（`ns1.cloudflare.com`），即把解析工作托管给 Cloudflare。

---

## 3. 其他记录类型 (SRV, CAA, PTR)

- **SRV 记录**：记录微服务的端口、优先级和权重（常见于其 Active Directory、语音业务）。
- **CAA 记录**：限制哪些 CA 机构可以为该域名签发证书（安全加固）。
- **PTR 记录**：反向 DNS 解析（IP 反查域名），通常用于邮件服务器防止被判定为垃圾邮件。

---

## 4. 常见配置场景实战

### 场景一：GitHub Pages 绑定自定义域名

1.  **子域名 (`www.guqzhou.eu.org`)**：
    - 类型：`CNAME`
    - 主机记录：`www`
    - 记录值：`guqzhou.github.io`
2.  **根域名 (`guqzhou.eu.org`)**：
    - 类型：`A`
    - 主机记录：`@`
    - 记录值：(GitHub 的 4 个 IP)
      - `185.199.108.153`
      - `185.199.109.153`
      - `185.199.110.153`
      - `185.199.111.153`

### 场景二：配置企业邮箱 (以腾讯企业邮为例)

1.  **主机记录 `@`** -> **MX** -> `mxbiz1.qq.com` (优先级 5)
2.  **主机记录 `@`** -> **MX** -> `mxbiz2.qq.com` (优先级 10)
3.  **主机记录 `@`** -> **TXT** -> `v=spf1 include:spf.mail.qq.com ~all` (SPF 防伪造)

### 场景三：配置 CDN 加速

1.  在 CDN 控制台添加域名 `img.example.com`，获得 CNAME 地址 `img.example.com.w.kunland.com`。
2.  在 DNS 解析处：
    - 主机记录：`img`
    - 类型：`CNAME`
    - 记录值：`img.example.com.w.kunland.com`

### 场景四：使用 Cloudflare 加速 GitHub Pages (推荐)

GitHub Pages 在国内访问速度可能较慢，使用 Cloudflare (CF) 可以免费加速并提供 HTTPS。

**配置步骤**：

1.  **接管 DNS**：
    - 在 Cloudflare 添加您的域名（如 `guqzhou.eu.org`）。
    - 按照 CF 提示，去原域名注册商（如阿里云、腾讯云）将 NS 记录修改为 CF 提供的两个 NS 地址（如 `kate.ns.cloudflare.com` 等）。
2.  **配置解析**：
    - 在 CF 后台添加 `CNAME` 记录：`www` 指向 `guqzhou.github.io`。
    - **关键点**：开启 **"Proxied" (橙色云朵图标)**。这代表流量会经过 CF 的 CDN 节点，从而实现加速和隐藏源站 IP。
    - 根域名 `@` 同样可以通过 CNAME 指向 `guqzhou.github.io` (CF 支持 CNAME Flattening)，同样开启橙色云朵。
3.  **SSL 设置**：
    - 在 CF 的 SSL/TLS 设置中，选择 **"Full"** 或 **"Full (Strict)"** 模式（因为 GitHub Pages 只要绑定了域名就会自动把 HTTPS 转正）。

**优势**：

- **全球 CDN 加速**：自动缓存静态资源。
- **安全防护**：隐藏 GitHub 源站，防 DDoS。
- **Always Online**：源站挂了也能显示缓存副本。

## 5. 常见问题 (FAQ)

**Q: 修改了解析为什么不生效？**
A: DNS 解析有 **TTL (Time To Live)** 缓存时间（通常 10 分钟/600 秒）。修改后，全球各地生效时间不一，受各地运营商缓存影响，最长可能需要 24-48 小时（通常几分钟内即可）。可以使用 `nslookup` 或 `dig` 命令查询当前生效的解析 IP。

**Q: 根域名 `@` 能配置 CNAME 吗？**
A: 标准协议不支持。如果配置了 CNAME，MX 记录（邮箱）会失效。但在 Cloudflare 等服务商，可以通过 CNAME Flattening (Alias) 技术实现类似效果。

**Q: 什么是泛解析？**
A: 主机记录填 `*`，例如 `*.example.com` 解析到某个 IP。这样访问 `a.example.com`、`b.example.com` 都会指向同一个 IP。
